name: "Second action"
on:
  workflow_run:
    workflows: ["First action"]
    types: [completed]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      # checkoutでrefを指定しないとmainを持ってきてしまう
      - uses: actions/checkout@v3
        with:
          ref: "update-src"
      - name: Download a single artifact
        uses: dawidd6/action-download-artifact@v2
        id: download
        with:
          workflow: first-action.yml
          name: ref-base
          workflow_conclusion: success
      - name: Download a single artifact 2
        uses: dawidd6/action-download-artifact@v2
        id: download
        with:
          workflow: first-action.yml
          name: ref-original
          workflow_conclusion: success
      - name: set REF_BASE to env
        run: |
          cat ref-base.txt
          cat ref-original.txt
          echo "REF_BASE=$(cat ref-base.txt)" >> $GITHUB_ENV
          echo "REF_ORIGINAL=$(cat ref-original.txt)" >> $GITHUB_ENV
      - uses: dorny/paths-filter@v2
        id: filter
        with:
          base: ${{ env.REF_BASE }}
          ref: ${{ env.REF_ORIGINAL }}
          filters: |
            src:
              - src/**
            lib:
              - lib/**
      - name: check
        run: |
          echo '${{ toJSON(steps.filter.outputs) }}'
